<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sol Sniper Bot PRO Cloud</title>
    <style>
        :root {
            --bg: #020617;
            --card: rgba(15, 23, 42, 0.96);
            --accent: #22d3ee;
            --accent2: #a855f7;
            --text: #f9fafb;
            --muted: #9ca3af;
            --success: #4ade80;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: #020617;
            color: var(--text);
            margin: 0;
            display: grid;
            grid-template-columns: 240px 1fr;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            background: rgba(15, 23, 42, 0.98);
            border-right: 1px solid rgba(55, 65, 81, 0.6);
            padding: 24px;
        }

        .logo {
            font-size: 20px;
            font-weight: 800;
            background: linear-gradient(90deg, #22d3ee, #a855f7);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 40px;
        }

        .nav-item {
            display: block;
            padding: 12px;
            color: var(--muted);
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.2s;
        }

        .nav-item:hover,
        .nav-item.active {
            background: rgba(34, 211, 238, 0.1);
            color: var(--accent);
        }

        /* Main Content */
        .main {
            padding: 32px;
            overflow-y: auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            border-radius: 999px;
            background: rgba(74, 222, 128, 0.1);
            color: var(--success);
            font-size: 12px;
            border: 1px solid rgba(74, 222, 128, 0.3);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            box-shadow: 0 0 8px var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 0.5;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.5;
            }
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .card {
            background: var(--card);
            border: 1px solid rgba(55, 65, 81, 0.8);
            border-radius: 14px;
            padding: 20px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--muted);
            margin-bottom: 6px;
        }

        .stat-val {
            font-size: 24px;
            font-weight: 700;
        }

        .console-box {
            background: #000;
            border: 1px solid rgba(34, 211, 238, 0.3);
            border-radius: 12px;
            padding: 16px;
            font-family: monospace;
            height: 300px;
            overflow-y: auto;
            font-size: 12px;
            color: #ccc;
        }

        .log-line {
            margin-bottom: 4px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
        }

        .btn-primary {
            background: var(--accent);
            color: #000;
        }

        .btn-danger {
            background: #f97373;
            color: white;
        }

        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Simulator Toggle */
        .sim-toggle-wrap {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            background: rgba(34, 211, 238, 0.05);
            padding: 10px 16px;
            border-radius: 999px;
            border: 1px solid rgba(34, 211, 238, 0.2);
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: #334155;
            border-radius: 999px;
            cursor: pointer;
            transition: 0.3s;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            left: 2px;
            top: 2px;
            width: 20px;
            height: 20px;
            background: #fff;
            border-radius: 50%;
            transition: 0.3s;
        }

        .toggle-active {
            background: #22c55e;
        }

        .toggle-active::after {
            transform: translateX(20px);
        }

        /* Matrix Mode */
        body.sim-mode {
            --accent: #4ade80;
            --text: #dcfce7;
        }

        body.sim-mode .logo {
            background: linear-gradient(90deg, #4ade80, #22c55e);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* ========== MOBILE RESPONSIVE ========== */
        @media (max-width: 768px) {
            body {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: fixed;
                left: -260px;
                top: 0;
                bottom: 0;
                width: 240px;
                z-index: 1000;
                transition: left 0.3s ease;
            }

            .sidebar.open {
                left: 0;
            }

            .main {
                padding: 16px;
                margin-left: 0;
            }

            .main header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .grid-3 {
                grid-template-columns: 1fr;
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }

            .card {
                padding: 16px;
            }

            h1 {
                font-size: 20px !important;
            }

            .btn {
                padding: 10px 16px;
                font-size: 12px;
            }

            /* Mobile menu toggle */
            .mobile-menu-toggle {
                display: block !important;
                position: fixed;
                top: 16px;
                right: 16px;
                z-index: 1001;
                background: var(--card);
                border: 1px solid rgba(55, 65, 81, 0.6);
                color: var(--text);
                padding: 10px 12px;
                border-radius: 8px;
                cursor: pointer;
            }

            /* Strategy cards mobile */
            .strategies-grid {
                grid-template-columns: 1fr !important;
            }

            /* Leaderboard mobile */
            .leaderboard-row {
                flex-direction: column;
                gap: 8px;
            }

            /* Copy trading cards mobile */
            .leader-cards {
                grid-template-columns: 1fr !important;
            }

            /* Filter tabs mobile */
            .strat-filters {
                flex-wrap: wrap;
            }

            .strat-filter {
                flex: 1;
                min-width: 80px;
                text-align: center;
            }

            /* Fix inputs overflowing on mobile */
            input,
            select,
            textarea {
                max-width: 100% !important;
                box-sizing: border-box !important;
            }

            /* Cards should not overflow */
            .card {
                overflow: hidden;
                word-wrap: break-word;
            }

            /* License key input fix */
            #license-key-input,
            #cfg-pk {
                font-size: 12px !important;
            }

            /* Main content padding fix */
            .main {
                padding: 16px;
                padding-bottom: 80px;
            }

            /* Ensure sidebar is fully hidden */
            .sidebar:not(.open) {
                left: -260px !important;
                visibility: hidden;
            }

            .sidebar.open {
                visibility: visible;
            }
        }

        /* Tablet adjustments */
        @media (min-width: 769px) and (max-width: 1024px) {
            .grid-3 {
                grid-template-columns: repeat(2, 1fr);
            }

            .strategies-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }

        /* Hide mobile toggle on desktop */
        .mobile-menu-toggle {
            display: none;
        }
    </style>
</head>

<body>
    <div id="loader" class="overlay">
        <div style="color:var(--accent);">Connecting to Neural Cloud...</div>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">‚ò∞</button>

    <div class="sidebar" id="sidebar">
        <a href="/" class="logo" style="text-decoration:none; cursor:pointer;">SSB CLOUD</a>
        <a href="#" class="nav-item active" onclick="switchTab('dashboard', this)">Dashboard</a>
        <a href="#" class="nav-item" onclick="switchTab('wallet', this)">Wallet & RPC</a>
        <a href="#" class="nav-item" onclick="switchTab('strategies', this)">üß† Strategies</a>
        <a href="#" class="nav-item" onclick="switchTab('affiliate', this)">üí∏ Affiliate</a>
        <a href="#" class="nav-item" onclick="switchTab('leaderboard', this)">üèÜ Leaderboard</a>
        <a href="#" class="nav-item" onclick="switchTab('copytrading', this)">üéØ Copy Tuning</a>
        <a href="#" class="nav-item" onclick="logout()">Logout</a>
    </div>

    <div class="main">
        <!-- Dashboard View -->
        <div id="view-dashboard">
            <header>
                <div>
                    <h1 style="margin:0; font-size:24px;">Command Center</h1>
                    <div style="font-size:12px; color:var(--muted); margin-top:4px;" id="user-email">...</div>
                </div>
                <div>
                    <span class="status-badge">
                        <span class="status-dot"></span>
                        ENGINE ONLINE
                    </span>
                </div>
            </header>

            <div class="sim-toggle-wrap">
                <div class="toggle-switch toggle-active" id="sim-toggle" onclick="toggleSimulator()"></div>
                <div style="font-size:13px; font-weight:600;">
                    <span id="sim-label">üü¢ LIVE MODE</span>
                    <span style="font-size:11px; color:var(--muted); display:block;">Click to switch to Dry Run</span>
                </div>
            </div>

            <div class="grid-3">
                <div class="card">
                    <div class="stat-label">TODAY'S PNL</div>
                    <div class="stat-val" style="color:#4ade80;" id="stat-pnl">+$0.00</div>
                </div>
                <div class="card">
                    <div class="stat-label">TOKENS SCANNED</div>
                    <div class="stat-val" style="color:#22d3ee;" id="stat-scanned">0</div>
                </div>
                <div class="card">
                    <div class="stat-label">ACTIVE PLAN</div>
                    <div class="stat-val" id="stat-plan">...</div>
                </div>
            </div>

            <div class="card" style="margin-bottom:24px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:16px;">
                    <h3>Live Execution Log</h3>
                    <div style="display:flex; gap:8px;">
                        <button class="btn" onclick="openSettings()" style="background:#4f46e5;">‚öôÔ∏è SETTINGS</button>
                        <button class="btn btn-primary" onclick="startBot()">START ENGINE</button>
                        <button class="btn btn-danger" onclick="stopBot()">STOP</button>
                    </div>
                </div>
                <div class="console-box" id="console">
                    <div class="log-line">[SYSTEM] Connecting to WebSocket...</div>
                    <div class="log-line">[SYSTEM] Authenticated as user.</div>
                    <div class="log-line">[ENGINE] Waiting for commands...</div>
                </div>
            </div>

            <!-- Settings Modal -->
            <div id="settings-modal"
                style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.8); z-index:9999; display:none; justify-content:center; align-items:center;">
                <div style="background:var(--surface); border-radius:12px; padding:24px; width:400px; max-width:90%;">
                    <h2 style="margin-top:0; color:var(--accent);">‚öôÔ∏è Bot Settings</h2>

                    <div style="margin-bottom:16px;">
                        <label style="display:block; margin-bottom:4px; color:var(--muted);">Position Size (SOL)</label>
                        <input type="number" id="setting-position" value="0.1" step="0.1" min="0.05" max="10"
                            style="width:100%; padding:10px; background:#1e293b; border:1px solid #334155; border-radius:6px; color:white;">
                    </div>

                    <div style="margin-bottom:16px;">
                        <label style="display:block; margin-bottom:4px; color:var(--muted);">Confidence Threshold
                            (%)</label>
                        <input type="number" id="setting-confidence" value="30" step="5" min="10" max="95"
                            style="width:100%; padding:10px; background:#1e293b; border:1px solid #334155; border-radius:6px; color:white;">
                    </div>

                    <div style="margin-bottom:16px;">
                        <label style="display:block; margin-bottom:4px; color:var(--muted);">Take Profit (%)</label>
                        <input type="number" id="setting-tp" value="30" step="5" min="5" max="200"
                            style="width:100%; padding:10px; background:#1e293b; border:1px solid #334155; border-radius:6px; color:white;">
                    </div>

                    <div style="margin-bottom:24px;">
                        <label style="display:block; margin-bottom:4px; color:var(--muted);">Stop Loss (%)</label>
                        <input type="number" id="setting-sl" value="15" step="5" min="5" max="50"
                            style="width:100%; padding:10px; background:#1e293b; border:1px solid #334155; border-radius:6px; color:white;">
                    </div>

                    <div style="display:flex; gap:12px;">
                        <button class="btn btn-primary" onclick="saveSettings()" style="flex:1;">üíæ Save
                            Settings</button>
                        <button class="btn" onclick="closeSettings()"
                            style="flex:1; background:#374151;">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Wallet Settings View -->
        <div id="view-wallet" style="display:none; max-width: 800px;">
            <header>
                <div>
                    <h1 style="margin:0; font-size:24px;">Wallet & Infrastructure</h1>
                    <div style="font-size:12px; color:var(--muted); margin-top:4px;">Manage your keys and RPC
                        connections</div>
                </div>
            </header>

            <div class="card" style="margin-bottom: 24px; border-color: rgba(34,211,238,0.3);">
                <h3 style="margin-top:0; color:var(--accent);">üîë Trading Wallet</h3>
                <p style="font-size:13px; color:var(--muted); margin-bottom:20px;">
                    Your private key is required for the bot to sign transactions in Live Mode.
                    It is encrypted using AES-256 before storage and never exposed to the frontend.
                </p>

                <div style="margin-bottom:16px;">
                    <label style="font-size:12px; font-weight:600; display:block; margin-bottom:8px;">PRIVATE KEY
                        (Base58)</label>
                    <div style="position:relative;">
                        <input type="password" id="cfg-pk" placeholder="Paste your Phantom wallet private key..."
                            style="width:100%; padding:12px; padding-right:80px; background:rgba(0,0,0,0.3); border:1px solid #334155; color:white; border-radius:6px; font-family:monospace;">
                        <button type="button" onclick="toggleKeyVisibility()" id="toggle-key-btn"
                            style="position:absolute; right:8px; top:50%; transform:translateY(-50%); background:rgba(255,255,255,0.1); border:none; color:var(--muted); padding:6px 12px; border-radius:4px; cursor:pointer; font-size:11px;">
                            üëÅÔ∏è SHOW
                        </button>
                    </div>
                </div>

                <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
                    <button class="btn btn-primary" onclick="saveConfig()">üîí SAVE SECURELY</button>
                    <div id="save-status"
                        style="font-size:13px; display:none; padding:8px 16px; border-radius:6px; background:rgba(74,222,128,0.1); border:1px solid rgba(74,222,128,0.3);">
                    </div>
                </div>

                <div style="margin-top:24px; padding:16px; background:rgba(255,255,255,0.03); border-radius:8px;">
                    <div
                        style="font-size:11px; text-transform:uppercase; letter-spacing:1px; color:var(--muted); margin-bottom:8px;">
                        Current Status</div>
                    <div style="font-display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <div style="font-size:12px; color:var(--muted);">Wallet Address</div>
                            <div style="font-family:monospace; color:var(--text);" id="wallet-address-display">Not
                                Configured</div>
                        </div>
                        <div style="text-align:right;">
                            <div style="font-size:12px; color:var(--muted);">Balance</div>
                            <div style="font-weight:700; color:#4ade80;" id="wallet-balance-display">-- SOL</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LICENSE KEY ACTIVATION -->
            <div class="card" style="margin-top: 24px; border-color: rgba(74,222,128,0.4);">
                <h3 style="margin-top:0; color:#4ade80;">üîë Activate License Key</h3>
                <p style="font-size:13px; color:var(--muted); margin-bottom:16px;">
                    Enter your license key to unlock LIVE trading mode. Get a license key by purchasing a plan.
                </p>

                <div style="margin-bottom:16px;">
                    <label style="font-size:12px; font-weight:600; display:block; margin-bottom:8px;">LICENSE
                        KEY</label>
                    <input type="text" id="license-key-input" placeholder="SSB-XXXX-XXXX-XXXX-XXXX"
                        style="width:100%; padding:12px; background:rgba(0,0,0,0.3); border:1px solid #374151; color:white; border-radius:6px; font-family:monospace; text-transform:uppercase;">
                </div>

                <div style="display:flex; gap:12px; align-items:center;">
                    <button class="btn btn-primary" onclick="activateLicense()"
                        style="background:#4ade80; color:#000;">üöÄ ACTIVATE LICENSE</button>
                    <div id="license-status" style="font-size:12px; display:none;"></div>
                </div>

                <div style="margin-top:16px; padding:12px; background:rgba(255,255,255,0.03); border-radius:8px;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <div style="font-size:12px; color:var(--muted);">Current Plan</div>
                            <div style="font-weight:700;" id="current-plan-display">TRIAL (Simulator Only)</div>
                        </div>
                        <a href="/" class="btn"
                            style="background:rgba(168,85,247,0.2); color:#a855f7; border:1px solid rgba(168,85,247,0.3);">üíé
                            BUY LICENSE</a>
                    </div>
                </div>
            </div>

            <!-- Bot Settings (Plan-Gated) -->
            <div class="card" id="bot-settings-card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                    <h3 style="margin:0; color:#a855f7;">‚öôÔ∏è Bot Settings</h3>
                    <span id="plan-badge" class="status-badge"
                        style="background:rgba(168,85,247,0.1); border-color:rgba(168,85,247,0.3); color:#a855f7;">LOADING...</span>
                </div>

                <div id="settings-content">
                    <!-- Settings will be injected based on plan -->
                    <div style="padding:20px; text-align:center; color:var(--muted);">Loading your plan limits...</div>
                </div>
            </div>
        </div>

        <!-- Affiliate View (Viral Engine!) -->
        <div id="view-affiliate" style="display:none; max-width: 900px;">
            <header>
                <div>
                    <h1 style="margin:0; font-size:24px;">üí∏ Affiliate Program</h1>
                    <div style="font-size:12px; color:var(--muted); margin-top:4px;">Earn 15% recurring commission on
                        every referral</div>
                </div>
            </header>

            <!-- Referral Link Card -->
            <div class="card"
                style="margin-bottom: 24px; border-color: rgba(168,85,247,0.4); background: linear-gradient(135deg, rgba(168,85,247,0.1), rgba(34,211,238,0.05));">
                <h3 style="margin-top:0; color:#a855f7;">üîó Your Referral Link</h3>
                <div style="display:flex; gap:12px; align-items:center;">
                    <input type="text" id="ref-link" readonly
                        style="flex:1; padding:14px; background:rgba(0,0,0,0.4); border:1px solid #a855f7; color:white; border-radius:8px; font-family:monospace; font-size:13px;">
                    <button class="btn btn-primary" onclick="copyRefLink()" style="padding:14px 20px;">üìã COPY</button>
                </div>
                <p style="font-size:12px; color:var(--muted); margin-top:12px;">Share this link on Twitter, Discord,
                    Telegram - every signup earns you 15% of their payments FOREVER!</p>
            </div>

            <!-- Stats Grid -->
            <div class="grid-3" style="margin-bottom:24px;">
                <div class="card" style="text-align:center;">
                    <div style="font-size:36px; font-weight:800; color:#a855f7;" id="ref-total">0</div>
                    <div style="font-size:12px; color:var(--muted);">TOTAL REFERRALS</div>
                </div>
                <div class="card" style="text-align:center;">
                    <div style="font-size:36px; font-weight:800; color:#4ade80;" id="ref-earnings">$0</div>
                    <div style="font-size:12px; color:var(--muted);">LIFETIME EARNINGS</div>
                </div>
                <div class="card" style="text-align:center;">
                    <div style="font-size:36px; font-weight:800; color:#22d3ee;" id="ref-pending">$0</div>
                    <div style="font-size:12px; color:var(--muted);">PENDING PAYOUT</div>
                </div>
            </div>

            <!-- Claim Button -->
            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <h3 style="margin:0;">Request Payout</h3>
                        <p style="font-size:12px; color:var(--muted); margin:4px 0 0;">Minimum $50 required. Paid in
                            USDT within 48 hours.</p>
                    </div>
                    <button class="btn btn-primary" onclick="claimEarnings()" style="padding:12px 24px;">üí∞ CLAIM
                        NOW</button>
                </div>
            </div>
        </div>

        <!-- Leaderboard View (FOMO Engine!) -->
        <div id="view-leaderboard" style="display:none; max-width: 900px;">
            <header>
                <div>
                    <h1 style="margin:0; font-size:24px;">üèÜ Global Leaderboard</h1>
                    <div style="font-size:12px; color:var(--muted); margin-top:4px;">Top performers this month - Can you
                        beat them?</div>
                </div>
            </header>

            <div class="card">
                <table style="width:100%; border-collapse:collapse; font-size:13px;">
                    <thead>
                        <tr style="border-bottom:1px solid rgba(255,255,255,0.1);">
                            <th style="padding:12px; text-align:left; color:var(--muted);">RANK</th>
                            <th style="padding:12px; text-align:left; color:var(--muted);">TRADER</th>
                            <th style="padding:12px; text-align:right; color:var(--muted);">TOTAL PnL</th>
                            <th style="padding:12px; text-align:right; color:var(--muted);">WIN RATE</th>
                            <th style="padding:12px; text-align:center; color:var(--muted);">BADGES</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard-body">
                        <tr>
                            <td colspan="5" style="padding:20px; text-align:center; color:var(--muted);">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Copy Tuning View -->
        <div id="view-copytrading" style="display:none; max-width: 900px;">
            <header>
                <div>
                    <h1 style="margin:0; font-size:24px;">üéØ Copy Tuning</h1>
                    <div style="font-size:12px; color:var(--muted); margin-top:4px;">Copy profitable bot settings from
                        top traders</div>
                </div>
            </header>

            <div class="card"
                style="margin-bottom:24px; background: linear-gradient(135deg, rgba(34,211,238,0.1), rgba(168,85,247,0.05));">
                <h3 style="margin-top:0; color:var(--accent);">üéÆ How Copy Tuning Works</h3>
                <p style="font-size:13px; color:var(--muted);">
                    1. üîç Browse tuning settings from top performers below<br>
                    2. ‚ö° <strong>Apply Instant</strong> - Use their settings immediately<br>
                    3. üíæ <strong>Save to My Tunings</strong> - Save and test before using<br>
                    4. üìä <strong>Track Performance</strong> - Bot tells you if copied tuning beats your original!<br>
                    5. üèÜ <strong>Earn Rewards</strong> - If others profit from YOUR tuning, you earn XP!
                </p>
            </div>

            <!-- Comparison Banner -->
            <div id="tuning-comparison" class="card"
                style="display:none; margin-bottom:20px; background:rgba(74,222,128,0.1); border:1px solid rgba(74,222,128,0.3);">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <div style="color:#4ade80; font-weight:700;">üìà Tuning Performance Update</div>
                        <div id="tuning-comparison-text" style="font-size:13px; color:var(--muted);">Your copied tuning
                            is making +15% more profit than your original settings!</div>
                    </div>
                    <button class="btn" style="background:#4ade80; color:#000;" onclick="keepTuning()">‚úÖ Keep
                        This</button>
                </div>
            </div>

            <!-- Top Tunings to Copy -->
            <h3 style="margin-bottom:16px;">üèÜ Top Tunings Available</h3>
            <div id="copy-leaders-grid"
                style="display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap:16px;">
                <div class="card" style="text-align:center; padding:20px; color:var(--muted);">Loading top tunings...
                </div>
            </div>

            <!-- My Saved Tunings -->
            <h3 style="margin-top:32px; margin-bottom:16px;">üíæ My Saved Tunings</h3>
            <div id="my-copies-list" class="card">
                <div style="padding:20px; text-align:center; color:var(--muted);">No tunings saved yet. Copy a tuning
                    above to get started!</div>
            </div>

            <!-- My Shared Tuning Stats -->
            <div class="card"
                style="margin-top:24px; background:linear-gradient(135deg, rgba(168,85,247,0.1), rgba(34,211,238,0.05)); border:1px solid rgba(168,85,247,0.3);">
                <h3 style="margin-top:0; color:#a855f7;">üåü Your Tuning Rewards</h3>
                <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:16px; margin-top:12px;">
                    <div style="text-align:center;">
                        <div style="font-size:24px; font-weight:700; color:#a855f7;" id="tuning-copies">0</div>
                        <div style="font-size:11px; color:var(--muted);">People Using Your Tuning</div>
                    </div>
                    <div style="text-align:center;">
                        <div style="font-size:24px; font-weight:700; color:#4ade80;" id="tuning-generated-pnl">+$0</div>
                        <div style="font-size:11px; color:var(--muted);">Profit Generated for Others</div>
                    </div>
                    <div style="text-align:center;">
                        <div style="font-size:24px; font-weight:700; color:#22d3ee;" id="tuning-xp-earned">0 XP</div>
                        <div style="font-size:11px; color:var(--muted);">Rewards XP Earned</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Strategy Marketplace View -->
        <div id="view-strategies" style="display:none; max-width: 1000px;">
            <header>
                <div>
                    <h1 style="margin:0; font-size:24px;">üß† Strategy Marketplace</h1>
                    <div style="font-size:12px; color:var(--muted); margin-top:4px;">Share & discover profitable trading
                        configs</div>
                </div>
                <button class="btn btn-primary" onclick="showShareModal()" style="padding:10px 20px;">üì§ SHARE MY
                    STRATEGY</button>
            </header>

            <!-- Profit Tracker Widget -->
            <div class="card" id="profit-tracker"
                style="margin-bottom:24px; background: linear-gradient(135deg, rgba(74,222,128,0.15), rgba(34,211,238,0.08)); border:1px solid rgba(74,222,128,0.3); position:relative; overflow:hidden;">
                <div style="position:absolute; top:0; left:0; height:100%; background: linear-gradient(90deg, #4ade80, #22d3ee); opacity:0.1; transition: width 0.5s;"
                    id="profit-bar"></div>
                <div style="position:relative; z-index:1;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <div
                                style="font-size:11px; color:var(--muted); text-transform:uppercase; letter-spacing:1px;">
                                Monthly Progress</div>
                            <div style="font-size:28px; font-weight:800; margin-top:4px;" id="profit-amount">$0</div>
                        </div>
                        <div style="text-align:right;">
                            <div style="font-size:11px; color:var(--muted);">Subscription Cost</div>
                            <div style="font-size:18px; font-weight:600;" id="sub-cost">$99</div>
                        </div>
                    </div>
                    <div style="margin-top:16px; font-size:13px;" id="profit-message">Loading...</div>
                </div>
            </div>

            <!-- Filter Tabs -->
            <div style="display:flex; gap:8px; margin-bottom:20px; flex-wrap:wrap;">
                <button class="strat-filter active" onclick="filterStrategies('pnl', this)">üî• Top PnL</button>
                <button class="strat-filter" onclick="filterStrategies('upvotes', this)">üëç Most Liked</button>
                <button class="strat-filter" onclick="filterStrategies('downloads', this)">‚¨áÔ∏è Most Used</button>
                <button class="strat-filter" onclick="filterStrategies('new', this)">‚ú® Newest</button>
            </div>

            <!-- Strategy Grid -->
            <div id="strategies-grid"
                style="display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap:16px;">
                <div class="card" style="padding:30px; text-align:center; color:var(--muted);">Loading strategies...
                </div>
            </div>
        </div>

        <!-- Share Strategy Modal -->
        <div id="share-modal"
            style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:1000; align-items:center; justify-content:center;">
            <div class="card" style="width:90%; max-width:500px; padding:24px;">
                <h2 style="margin-top:0;">üì§ Share Your Strategy</h2>
                <p style="color:var(--muted); font-size:13px;">Help others profit! Share your config settings.</p>

                <div style="margin-bottom:16px;">
                    <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:6px;">Strategy
                        Name</label>
                    <input type="text" id="strat-name" placeholder="e.g. Diamond Hands Sniper"
                        style="width:100%; padding:10px; background:rgba(0,0,0,0.3); border:1px solid #374151; color:white; border-radius:6px;">
                </div>

                <div style="margin-bottom:16px;">
                    <label
                        style="font-size:12px; color:var(--muted); display:block; margin-bottom:6px;">Description</label>
                    <textarea id="strat-desc" placeholder="Describe your strategy..." rows="3"
                        style="width:100%; padding:10px; background:rgba(0,0,0,0.3); border:1px solid #374151; color:white; border-radius:6px; resize:none;"></textarea>
                </div>

                <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:16px;">
                    <div>
                        <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:6px;">Risk
                            Level</label>
                        <select id="strat-risk"
                            style="width:100%; padding:10px; background:rgba(0,0,0,0.3); border:1px solid #374151; color:white; border-radius:6px;">
                            <option value="low">üü¢ Low Risk</option>
                            <option value="medium" selected>üü° Medium</option>
                            <option value="high">üü† High</option>
                            <option value="degen">üî¥ DEGEN</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:6px;">Min
                            Confidence</label>
                        <input type="number" id="strat-conf" value="75" min="50" max="100"
                            style="width:100%; padding:10px; background:rgba(0,0,0,0.3); border:1px solid #374151; color:white; border-radius:6px;">
                    </div>
                </div>

                <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px; margin-bottom:20px;">
                    <div>
                        <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:6px;">Take Profit
                            %</label>
                        <input type="number" id="strat-tp" value="30"
                            style="width:100%; padding:10px; background:rgba(0,0,0,0.3); border:1px solid #374151; color:white; border-radius:6px;">
                    </div>
                    <div>
                        <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:6px;">Stop Loss
                            %</label>
                        <input type="number" id="strat-sl" value="15"
                            style="width:100%; padding:10px; background:rgba(0,0,0,0.3); border:1px solid #374151; color:white; border-radius:6px;">
                    </div>
                    <div>
                        <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:6px;">Max Size
                            (SOL)</label>
                        <input type="number" id="strat-size" value="0.5" step="0.1"
                            style="width:100%; padding:10px; background:rgba(0,0,0,0.3); border:1px solid #374151; color:white; border-radius:6px;">
                    </div>
                </div>

                <div style="display:flex; gap:12px;">
                    <button class="btn" onclick="hideShareModal()" style="flex:1; background:#374151;">Cancel</button>
                    <button class="btn btn-primary" onclick="submitStrategy()" style="flex:2;">üöÄ SHARE WITH
                        COMMUNITY</button>
                </div>
            </div>
        </div>
    </div>

    <style>
        .strat-filter {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--muted);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .strat-filter:hover,
        .strat-filter.active {
            background: rgba(34, 211, 238, 0.2);
            border-color: var(--accent);
            color: var(--accent);
        }

        .strategy-card {
            position: relative;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .strategy-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(34, 211, 238, 0.15);
        }

        .strategy-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #22d3ee, #a855f7);
        }

        .risk-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
        }

        .risk-low {
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
        }

        .risk-medium {
            background: rgba(250, 204, 21, 0.2);
            color: #facc15;
        }

        .risk-high {
            background: rgba(251, 146, 60, 0.2);
            color: #fb923c;
        }

        .risk-degen {
            background: rgba(248, 113, 113, 0.2);
            color: #f87171;
        }

        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }

            100% {
                background-position: 200% 0;
            }
        }

        .featured-badge {
            background: linear-gradient(90deg, #fbbf24, #f59e0b, #fbbf24);
            background-size: 200% auto;
            animation: shimmer 2s linear infinite;
            color: #000;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
        }
    </style>

    <script>
        // Use current host for API (works on VPS and local)
        const API_BASE = "https://api.ssbpro.dev";
        const API = API_BASE + "/v1";
        let userPlan = 'trial'; // Global plan variable - default to trial for freemium

        async function init() {
            const token = localStorage.getItem('ssb_token');
            if (!token) window.location.href = '/auth.html';

            try {
                // Fetch current user from /me endpoint (has actual plan)
                const meRes = await fetch(`${API}/me`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (meRes.status === 401) logout();

                const me = await meRes.json();
                document.getElementById('user-email').innerText = me.email;

                // Store plan globally - from direct user object, not license
                userPlan = me.plan || 'trial';
                document.getElementById('stat-plan').innerText = userPlan.toUpperCase().replace(/_/g, ' ');

                // Update ALL plan display elements
                const planDisplay = userPlan.toUpperCase().replace(/_/g, ' ');
                const planBadge = document.getElementById('plan-badge');
                const currentPlanDisplay = document.getElementById('current-plan-display');

                if (planBadge) planBadge.innerText = planDisplay;
                if (currentPlanDisplay) {
                    if (userPlan.toLowerCase() === 'admin') {
                        currentPlanDisplay.innerHTML = 'ADMIN (GOD MODE)';
                    } else if (userPlan.toLowerCase() !== 'trial') {
                        currentPlanDisplay.innerHTML = planDisplay + ' (LIVE ENABLED)';
                    } else {
                        currentPlanDisplay.innerHTML = 'TRIAL (Simulator Only)';
                    }
                }

                // Load plan-gated settings
                loadPlanSettings(userPlan);

                // Fetch Cloud Status
                try {
                    const statusRes = await fetch(`${API}/user/cloud-status`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (statusRes.ok) {
                        const status = await statusRes.json();
                        document.getElementById('stat-pnl').innerText = `+$${status.pnl_today || 0}`;
                        document.getElementById('stat-scanned').innerText = status.tokens_scanned || 0;
                    }
                } catch (e) {
                    console.log('Cloud status not available');
                }

                // Check if engine is already running (auto-resume)
                try {
                    const engineRes = await fetch(`${API}/engine/status`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (engineRes.ok) {
                        const engineData = await engineRes.json();
                        if (engineData.status === 'running') {
                            log("[ENGINE] Auto-resuming - engine is already running on server");
                            startPollingEngine();
                        }
                    }
                } catch (e) {
                    console.log('Engine status check skipped');
                }

                // Load wallet status (show saved wallet on reload)
                try {
                    const walletRes = await fetch(`${API}/wallet/status`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (walletRes.ok) {
                        const walletData = await walletRes.json();
                        if (walletData.configured) {
                            document.getElementById('wallet-address-display').innerText = walletData.address;
                            document.getElementById('wallet-balance-display').innerText = walletData.balance + ' SOL';
                        }
                    }
                } catch (e) {
                    console.log('Wallet status check skipped');
                }

                document.getElementById('loader').style.display = 'none';
            } catch (e) {
                console.error(e);
                // Fallback to logout on error
                logout();
            }
        }

        // Simulation Logic
        let isSimMode = false;
        let pollInterval = null;

        function toggleSimulator() {
            isSimMode = !isSimMode;
            document.body.classList.toggle('sim-mode');
            const toggle = document.getElementById('sim-toggle');
            toggle.classList.toggle('toggle-active');

            const label = document.getElementById('sim-label');
            if (isSimMode) {
                // DRY RUN mode - grey toggle
                label.innerHTML = "üß™ DRY RUN MODE";
                document.getElementById('stat-plan').innerText = "SIMULATOR";
                startPollingSim();
            } else {
                // LIVE mode - green toggle
                label.innerHTML = "üü¢ LIVE MODE";
                location.reload(); // Reset to live state
            }
        }

        async function startBot() {
            if (isSimMode) {
                await fetch(`${API}/simulation/start`, { method: 'POST' });
                log("Executing Dry Run on Neural Engine...");
            } else {
                // Check if user has a cloud plan that allows live trading
                const cloudPlans = ['cloud_sniper', 'cloud_sniper_pro', 'cloud_sniper_elite', 'pro', 'elite', 'standard', 'admin', 'whale', 'trial'];
                if (cloudPlans.includes(userPlan?.toLowerCase())) {
                    log("[ENGINE] Starting LIVE trading engine...");
                    log("[ENGINE] Connecting to Pump.fun WebSocket...");
                    try {
                        const token = localStorage.getItem('ssb_token');
                        const res = await fetch(`${API}/engine/start`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ mode: 'LIVE' })  // Tell engine to use LIVE mode with saved wallet
                        });
                        const data = await res.json();
                        if (data.success) {
                            log("[ENGINE] ‚úÖ Live engine started successfully!");
                            log("[ENGINE] Scanning for opportunities...");
                            startPollingEngine(); // Start polling for real-time logs
                        } else {
                            log("[ENGINE] ‚ùå " + (data.detail || data.message || "Failed to start engine"));
                        }
                    } catch (e) {
                        log("[ENGINE] ‚ùå Connection error: " + e.message);
                    }
                } else {
                    alert("Live trading engine requires active Cloud subscription. Your current plan: " + (userPlan || "trial"));
                }
            }
        }

        async function stopBot() {
            if (isSimMode) {
                await fetch(`${API}/simulation/stop`, { method: 'POST' });
                log("Stopping Simulation...");
            } else {
                log("[ENGINE] Stopping live engine...");
                try {
                    const token = localStorage.getItem('ssb_token');
                    await fetch(`${API}/engine/stop`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    log("[ENGINE] Engine stopped.");
                    stopPollingEngine(); // Stop polling
                } catch (e) {
                    log("[ENGINE] Error: " + e.message);
                }
            }
        }

        function startPollingSim() {
            if (pollInterval) clearInterval(pollInterval);
            pollInterval = setInterval(async () => {
                if (!isSimMode) return;
                try {
                    const res = await fetch(`${API}/simulation/state`);
                    const data = await res.json();

                    if (data.is_running) {
                        document.getElementById('stat-pnl').innerText = `+${data.total_pnl.toFixed(4)} SOL`;
                        document.getElementById('stat-scanned').innerText = data.tokens_scanned;

                        // Update Logs
                        const consoleBox = document.getElementById('console');
                        consoleBox.innerHTML = ""; // Clear for demo stream effect
                        data.recent_logs.forEach(msg => {
                            const d = document.createElement('div');
                            d.className = 'log-line';
                            d.innerHTML = msg;
                            consoleBox.appendChild(d);
                        });
                        consoleBox.scrollTop = consoleBox.scrollHeight;
                    }
                } catch (e) { console.error(e); }
            }, 1000); // 1s poll rate
        }

        // Live engine state polling
        let enginePollInterval = null;

        function startPollingEngine() {
            if (enginePollInterval) clearInterval(enginePollInterval);
            const token = localStorage.getItem('ssb_token');

            enginePollInterval = setInterval(async () => {
                if (isSimMode) return; // Only poll when in live mode
                try {
                    const res = await fetch(`${API}/engine/state`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    const data = await res.json();

                    if (data.success && data.is_running) {
                        // Update stats
                        document.getElementById('stat-scanned').innerText = data.tokens_scanned || 0;
                        if (data.total_pnl) {
                            document.getElementById('stat-pnl').innerText = `+$${data.total_pnl.toFixed(2)}`;
                        }

                        // Update console with logs
                        if (data.logs && data.logs.length > 0) {
                            const consoleBox = document.getElementById('console');
                            consoleBox.innerHTML = ""; // Clear for fresh logs
                            data.logs.forEach(logEntry => {
                                const d = document.createElement('div');
                                d.className = 'log-line';
                                const lvl = logEntry.level || 'info';
                                const ts = logEntry.timestamp || '';
                                const msg = logEntry.message || '';
                                // Color code by level
                                let color = '#00ff88';
                                if (lvl === 'warning') color = '#ffa500';
                                if (lvl === 'danger' || lvl === 'error') color = '#ff4444';
                                if (lvl === 'success') color = '#00ff88';
                                d.innerHTML = `<span style="color:${color}">[${ts}] [${lvl.toUpperCase()}]</span> ${msg}`;
                                consoleBox.appendChild(d);
                            });
                            consoleBox.scrollTop = consoleBox.scrollHeight;
                        }
                    }
                } catch (e) {
                    console.error('Engine poll error:', e);
                }
            }, 2000); // 2s poll rate for live engine
        }

        function stopPollingEngine() {
            if (enginePollInterval) {
                clearInterval(enginePollInterval);
                enginePollInterval = null;
            }
        }

        // Settings Modal Functions
        function openSettings() {
            // Load saved settings
            const savedSettings = JSON.parse(localStorage.getItem('ssb_bot_settings') || '{}');
            document.getElementById('setting-position').value = savedSettings.position_size || 0.1;
            document.getElementById('setting-confidence').value = savedSettings.confidence || 30;
            document.getElementById('setting-tp').value = savedSettings.take_profit || 30;
            document.getElementById('setting-sl').value = savedSettings.stop_loss || 15;

            document.getElementById('settings-modal').style.display = 'flex';
        }

        function closeSettings() {
            document.getElementById('settings-modal').style.display = 'none';
        }

        async function saveSettings() {
            const settings = {
                position_size: parseFloat(document.getElementById('setting-position').value),
                confidence: parseInt(document.getElementById('setting-confidence').value),
                take_profit: parseInt(document.getElementById('setting-tp').value),
                stop_loss: parseInt(document.getElementById('setting-sl').value)
            };

            // Save locally
            localStorage.setItem('ssb_bot_settings', JSON.stringify(settings));

            // Save to server
            try {
                const token = localStorage.getItem('ssb_token');
                await fetch(`${API}/engine/settings`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });
            } catch (e) {
                console.log('Settings saved locally only');
            }

            log(`Settings saved: ${settings.position_size} SOL, ${settings.confidence}% confidence`);
            closeSettings();
        }

        function log(msg) {
            const consoleBox = document.getElementById('console');
            const d = document.createElement('div');
            d.className = 'log-line';
            d.innerText = `[SYSTEM] ${msg}`;
            consoleBox.appendChild(d);
        }

        function logout() {
            localStorage.removeItem('ssb_token');
            window.location.href = '/auth.html';
        }

        // Tab Switching
        function switchTab(viewId, link) {
            // Hide all views
            document.getElementById('view-dashboard').style.display = 'none';
            document.getElementById('view-wallet').style.display = 'none';
            document.getElementById('view-affiliate').style.display = 'none';
            document.getElementById('view-leaderboard').style.display = 'none';
            document.getElementById('view-copytrading').style.display = 'none';
            document.getElementById('view-strategies').style.display = 'none';

            // Show selected
            document.getElementById('view-' + viewId).style.display = 'block';

            // Update nav
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            link.classList.add('active');

            // Load data for specific views
            if (viewId === 'affiliate') loadReferralStats();
            if (viewId === 'leaderboard') loadLeaderboard();
            if (viewId === 'copytrading') loadCopyTrading();
            if (viewId === 'strategies') loadStrategies();
        }

        // Configuration
        async function saveConfig() {
            const pk = document.getElementById('cfg-pk').value.trim();
            const rpc = document.getElementById('cfg-rpc').value.trim();
            const statusEl = document.getElementById('save-status');

            if (!pk) return;

            statusEl.style.display = 'block';
            statusEl.style.color = 'var(--accent)';
            statusEl.innerHTML = '‚è≥ Encrypting & Saving...';

            const token = localStorage.getItem('ssb_token');

            try {
                const res = await fetch(`${API}/bot/config`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        private_key: pk
                    })
                });

                const data = await res.json();

                if (data.success) {
                    statusEl.innerHTML = '‚úÖ Wallet Saved Securely';
                    statusEl.style.color = '#4ade80';
                    document.getElementById('cfg-pk').value = ''; // Clear for security
                    if (data.address) {
                        document.getElementById('wallet-address-display').innerText = data.address;
                        document.getElementById('wallet-balance-display').innerText = data.balance + ' SOL';
                    }
                } else {
                    statusEl.innerHTML = '‚ùå Error: ' + data.detail;
                    statusEl.style.color = '#f87171';
                }
            } catch (e) {
                console.error(e);
                statusEl.innerHTML = '‚ùå Connection Error';
                statusEl.style.color = '#f87171';
            }
        }

        // ========== PLAN-GATED SETTINGS ==========
        function loadPlanSettings(plan) {
            const badge = document.getElementById('plan-badge');
            const content = document.getElementById('settings-content');

            // Plan tiers and their features - ALL users can customize for testing
            const PLAN_FEATURES = {
                'trial': { canCustomize: true, label: 'TRIAL', color: '#4ade80', maxTP: 30, maxSL: 15, note: 'Simulator Only' },
                'demo': { canCustomize: true, label: 'DEMO', color: '#9ca3af', maxTP: 30, maxSL: 15 },
                'standard': { canCustomize: true, label: 'STANDARD', color: '#22d3ee', maxTP: 40, maxSL: 20 },
                'cloud_sniper': { canCustomize: true, label: 'CLOUD PRO', color: '#a855f7', maxTP: 50, maxSL: 25 },
                'pro': { canCustomize: true, label: 'PRO', color: '#fbbf24', maxTP: 100, maxSL: 50 },
                'elite': { canCustomize: true, label: 'ELITE', color: '#f43f5e', maxTP: 200, maxSL: 100, advanced: true }
            };

            const features = PLAN_FEATURES[plan] || PLAN_FEATURES['trial'];

            // Update badge
            badge.innerText = features.label;
            badge.style.color = features.color;
            badge.style.borderColor = features.color + '50';
            badge.style.background = features.color + '20';

            if (!features.canCustomize) {
                content.innerHTML = `
                    <div style="text-align:center; padding:20px;">
                        <div style="font-size:24px; margin-bottom:8px;">üîí</div>
                        <p style="color:var(--muted); margin:0;">Custom bot settings available on <strong style="color:#a855f7;">PRO</strong> and <strong style="color:#f43f5e;">ELITE</strong> plans.</p>
                        <a href="/pricing.html" class="btn btn-primary" style="margin-top:16px;">‚¨ÜÔ∏è UPGRADE</a>
                    </div>
                `;
                return;
            }

            // Build settings form based on plan limits
            content.innerHTML = `
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:16px;">
                    <div>
                        <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:6px;">Take Profit % (max ${features.maxTP}%)</label>
                        <input type="number" id="cfg-tp" value="30" min="5" max="${features.maxTP}" 
                            style="width:100%; padding:10px; background:rgba(0,0,0,0.3); border:1px solid #374151; color:white; border-radius:6px;">
                    </div>
                    <div>
                        <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:6px;">Stop Loss % (max ${features.maxSL}%)</label>
                        <input type="number" id="cfg-sl" value="15" min="5" max="${features.maxSL}"
                            style="width:100%; padding:10px; background:rgba(0,0,0,0.3); border:1px solid #374151; color:white; border-radius:6px;">
                    </div>
                </div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:16px;">
                    <div>
                        <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:6px;">Min Confidence Score</label>
                        <input type="number" id="cfg-conf" value="75" min="50" max="100"
                            style="width:100%; padding:10px; background:rgba(0,0,0,0.3); border:1px solid #374151; color:white; border-radius:6px;">
                    </div>
                    <div>
                        <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:6px;">Max Position Size (SOL)</label>
                        <input type="number" id="cfg-size" value="0.5" min="0.1" max="5" step="0.1"
                            style="width:100%; padding:10px; background:rgba(0,0,0,0.3); border:1px solid #374151; color:white; border-radius:6px;">
                    </div>
                </div>
                ${features.advanced ? `
                <div style="margin-bottom:16px; padding:12px; background:rgba(244,63,94,0.1); border:1px solid rgba(244,63,94,0.3); border-radius:8px;">
                    <div style="font-size:11px; color:#f43f5e; margin-bottom:8px;">‚ú® ELITE ONLY</div>
                    <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                        <input type="checkbox" id="cfg-trailing" checked style="width:18px; height:18px;">
                        <span>Enable Trailing Stop (locks in gains)</span>
                    </label>
                </div>
                ` : ''}
                <button class="btn btn-primary" onclick="saveBotSettings()" style="width:100%;">üíæ SAVE SETTINGS</button>
                <p style="font-size:11px; color:var(--muted); margin-top:12px; text-align:center;">Settings apply to your next trades automatically.</p>
            `;
        }

        async function saveBotSettings() {
            const token = localStorage.getItem('ssb_token');
            const settings = {
                take_profit: parseFloat(document.getElementById('cfg-tp')?.value || 30),
                stop_loss: parseFloat(document.getElementById('cfg-sl')?.value || 15),
                min_confidence: parseFloat(document.getElementById('cfg-conf')?.value || 75),
                max_position_size: parseFloat(document.getElementById('cfg-size')?.value || 0.5),
                trailing_stop: document.getElementById('cfg-trailing')?.checked ?? true
            };

            try {
                const res = await fetch(`${API}/bot/settings`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });
                const data = await res.json();

                if (data.success) {
                    alert('‚úÖ Bot settings saved! They will apply to your next trades.');
                } else {
                    alert('‚ùå ' + (data.detail || 'Failed to save settings'));
                }
            } catch (e) {
                alert('‚ùå Connection error');
            }
        }

        // ========== REFERRAL SYSTEM ==========
        async function loadReferralStats() {
            const token = localStorage.getItem('ssb_token');
            try {
                const res = await fetch(`${API}/referral/stats`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();

                document.getElementById('ref-link').value = data.referral_link;
                document.getElementById('ref-total').innerText = data.total_referrals;
                document.getElementById('ref-earnings').innerText = '$' + data.total_earnings.toFixed(2);
                document.getElementById('ref-pending').innerText = '$' + data.pending_earnings.toFixed(2);
            } catch (e) {
                console.error('Failed to load referral stats', e);
            }
        }

        function copyRefLink() {
            const link = document.getElementById('ref-link');
            link.select();
            document.execCommand('copy');
            alert('üîó Referral link copied! Share it to earn 15%!');
        }

        async function claimEarnings() {
            const token = localStorage.getItem('ssb_token');
            try {
                const res = await fetch(`${API}/referral/claim`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();

                if (data.success) {
                    alert('üí∞ ' + data.message);
                    loadReferralStats(); // Refresh
                } else {
                    alert('‚ùå ' + data.detail);
                }
            } catch (e) {
                alert('‚ùå Failed to claim earnings');
            }
        }

        // ========== LEADERBOARD ==========
        async function loadLeaderboard() {
            try {
                const res = await fetch(`${API}/referral/leaderboard`);
                const data = await res.json();

                const tbody = document.getElementById('leaderboard-body');
                tbody.innerHTML = '';

                data.leaderboard.forEach(entry => {
                    const pnlColor = entry.total_pnl >= 0 ? '#4ade80' : '#f87171';
                    const row = `
                        <tr style="border-bottom:1px solid rgba(255,255,255,0.05);">
                            <td style="padding:12px; font-weight:700;">${entry.rank <= 3 ? ['ü•á', 'ü•à', 'ü•â'][entry.rank - 1] : '#' + entry.rank}</td>
                            <td style="padding:12px;">${entry.username}</td>
                            <td style="padding:12px; text-align:right; font-weight:700; color:${pnlColor};">${entry.total_pnl >= 0 ? '+' : ''}$${entry.total_pnl.toFixed(2)}</td>
                            <td style="padding:12px; text-align:right;">${entry.win_rate.toFixed(1)}%</td>
                            <td style="padding:12px; text-align:center;">${entry.badges.join(' ')}</td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            } catch (e) {
                console.error('Failed to load leaderboard', e);
            }
        }

        // ========== COPY TRADING ==========
        async function loadCopyTrading() {
            await loadCopyLeaders();
            await loadMyCopies();
        }

        async function loadCopyLeaders() {
            try {
                const res = await fetch(`${API}/copy/leaders`);
                const data = await res.json();

                const grid = document.getElementById('copy-leaders-grid');
                grid.innerHTML = '';

                data.leaders.forEach(leader => {
                    const pnlColor = leader.total_pnl >= 0 ? '#4ade80' : '#f87171';
                    const card = `
                        <div class="card" style="padding:16px;">
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                                <div style="font-weight:700;">${leader.username}</div>
                                <div style="font-size:11px; color:var(--muted);">${leader.followers} followers</div>
                            </div>
                            <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:12px;">
                                <div>
                                    <div style="font-size:11px; color:var(--muted);">Total PnL</div>
                                    <div style="font-weight:700; color:${pnlColor};">${leader.total_pnl >= 0 ? '+' : ''}$${leader.total_pnl.toFixed(0)}</div>
                                </div>
                                <div>
                                    <div style="font-size:11px; color:var(--muted);">Win Rate</div>
                                    <div style="font-weight:700;">${leader.win_rate.toFixed(0)}%</div>
                                </div>
                            </div>
                            <div style="margin-bottom:12px;">${leader.badges.slice(0, 3).join(' ')}</div>
                            <button class="btn btn-primary" onclick="followLeader('${leader.user_id}')" style="width:100%;">üîÑ FOLLOW</button>
                        </div>
                    `;
                    grid.innerHTML += card;
                });
            } catch (e) {
                console.error('Failed to load copy leaders', e);
            }
        }

        async function followLeader(leaderId) {
            const token = localStorage.getItem('ssb_token');
            try {
                const res = await fetch(`${API}/copy/follow`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        leader_id: leaderId,
                        allocation_percent: 10,
                        max_trade_size: 0.5
                    })
                });
                const data = await res.json();

                if (data.success) {
                    alert('‚úÖ ' + data.message);
                    loadCopyTrading();
                } else {
                    alert('‚ùå ' + data.detail);
                }
            } catch (e) {
                alert('‚ùå Failed to follow');
            }
        }

        async function loadMyCopies() {
            const token = localStorage.getItem('ssb_token');
            try {
                const res = await fetch(`${API}/copy/my-copies`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();

                const container = document.getElementById('my-copies-list');

                if (data.active_copies.length === 0) {
                    container.innerHTML = '<div style="padding:20px; text-align:center; color:var(--muted);">You\'re not copying anyone yet. Follow a top performer above!</div>';
                    return;
                }

                container.innerHTML = data.active_copies.map(copy => `
                    <div style="display:flex; justify-content:space-between; align-items:center; padding:12px; border-bottom:1px solid rgba(255,255,255,0.05);">
                        <div>
                            <div style="font-weight:600;">${copy.leader_name}</div>
                            <div style="font-size:11px; color:var(--muted);">${copy.total_copied_trades} trades copied</div>
                        </div>
                        <div style="text-align:right;">
                            <div style="font-weight:700; color:#4ade80;">+$${copy.total_pnl.toFixed(2)}</div>
                            <div style="font-size:11px; color:var(--muted);">${copy.allocation}% allocation</div>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                console.error('Failed to load my copies', e);
            }
        }

        // ========== STRATEGY MARKETPLACE ==========
        let currentStratSort = 'pnl';

        async function loadStrategies() {
            await loadProfitTracker();
            await loadStrategyGrid(currentStratSort);
        }

        async function loadProfitTracker() {
            const token = localStorage.getItem('ssb_token');
            try {
                const res = await fetch(`${API}/strategies/profit-tracker`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();

                document.getElementById('profit-amount').innerText = `$${data.total_income.toFixed(0)}`;
                document.getElementById('sub-cost').innerText = `$${data.subscription_cost}`;
                document.getElementById('profit-message').innerHTML = data.covers_subscription
                    ? `üéâ <span style="color:#4ade80;">You've covered your subscription!</span> Surplus: <strong>$${data.surplus.toFixed(0)}</strong>`
                    : `üìà ${data.message}`;

                // Animate bar
                const percent = Math.min(100, (data.total_income / data.subscription_cost) * 100);
                document.getElementById('profit-bar').style.width = percent + '%';
            } catch (e) {
                console.error('Failed to load profit tracker', e);
            }
        }

        async function loadStrategyGrid(sortBy) {
            try {
                const res = await fetch(`${API}/strategies/browse?sort_by=${sortBy}`);
                const data = await res.json();

                const grid = document.getElementById('strategies-grid');

                if (data.strategies.length === 0) {
                    grid.innerHTML = '<div class="card" style="padding:40px; text-align:center; color:var(--muted);">No strategies shared yet. Be the first! üöÄ</div>';
                    return;
                }

                grid.innerHTML = data.strategies.map(s => {
                    const riskClass = `risk-${s.risk_level}`;
                    const pnlColor = s.total_pnl >= 0 ? '#4ade80' : '#f87171';
                    return `
                        <div class="card strategy-card" style="padding:16px;">
                            <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:12px;">
                                <div>
                                    <div style="font-weight:700; font-size:15px;">${s.name}</div>
                                    <div style="font-size:11px; color:var(--muted);">by ${s.author}</div>
                                </div>
                                <span class="risk-badge ${riskClass}">${s.risk_level.toUpperCase()}</span>
                            </div>
                            <p style="font-size:12px; color:var(--muted); margin:0 0 16px; line-height:1.4;">${s.description.slice(0, 80)}...</p>
                            <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:8px; text-align:center; margin-bottom:16px;">
                                <div>
                                    <div style="font-size:11px; color:var(--muted);">PnL</div>
                                    <div style="font-weight:700; color:${pnlColor};">${s.total_pnl >= 0 ? '+' : ''}$${s.total_pnl.toFixed(0)}</div>
                                </div>
                                <div>
                                    <div style="font-size:11px; color:var(--muted);">Win %</div>
                                    <div style="font-weight:700;">${s.win_rate.toFixed(0)}%</div>
                                </div>
                                <div>
                                    <div style="font-size:11px; color:var(--muted);">TP/SL</div>
                                    <div style="font-weight:700;">${s.take_profit}/${s.stop_loss}%</div>
                                </div>
                            </div>
                            <div style="display:flex; gap:8px; margin-bottom:12px;">
                                <span style="font-size:11px; color:var(--muted);">üëç ${s.upvotes}</span>
                                <span style="font-size:11px; color:var(--muted);">‚¨áÔ∏è ${s.downloads} uses</span>
                            </div>
                            <div style="display:flex; gap:8px;">
                                <button class="btn" onclick="upvoteStrategy('${s.id}')" style="flex:1; background:rgba(255,255,255,0.05); padding:8px;">üëç</button>
                                <button class="btn btn-primary" onclick="applyStrategy('${s.id}')" style="flex:2;">‚ö° APPLY</button>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (e) {
                console.error('Failed to load strategies', e);
            }
        }

        function filterStrategies(sortBy, btn) {
            currentStratSort = sortBy;
            document.querySelectorAll('.strat-filter').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            loadStrategyGrid(sortBy);
        }

        async function applyStrategy(stratId) {
            const token = localStorage.getItem('ssb_token');
            try {
                const res = await fetch(`${API}/strategies/${stratId}/apply`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();

                if (data.success) {
                    alert('‚ö° ' + data.message + '\n\nConfig:\n‚Ä¢ Take Profit: ' + data.config.take_profit + '%\n‚Ä¢ Stop Loss: ' + data.config.stop_loss + '%\n‚Ä¢ Risk: ' + data.config.risk_level);
                    loadStrategyGrid(currentStratSort);
                }
            } catch (e) {
                alert('‚ùå Failed to apply strategy');
            }
        }

        async function upvoteStrategy(stratId) {
            const token = localStorage.getItem('ssb_token');
            try {
                await fetch(`${API}/strategies/${stratId}/upvote`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                loadStrategyGrid(currentStratSort);
            } catch (e) {
                console.error('Upvote failed');
            }
        }

        function showShareModal() {
            document.getElementById('share-modal').style.display = 'flex';
        }

        function hideShareModal() {
            document.getElementById('share-modal').style.display = 'none';
        }

        async function submitStrategy() {
            const token = localStorage.getItem('ssb_token');
            const payload = {
                name: document.getElementById('strat-name').value,
                description: document.getElementById('strat-desc').value,
                risk_level: document.getElementById('strat-risk').value,
                min_confidence: parseFloat(document.getElementById('strat-conf').value),
                take_profit: parseFloat(document.getElementById('strat-tp').value),
                stop_loss: parseFloat(document.getElementById('strat-sl').value),
                max_position_size: parseFloat(document.getElementById('strat-size').value)
            };

            try {
                const res = await fetch(`${API}/strategies/share`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                const data = await res.json();

                if (data.success) {
                    alert('üöÄ ' + data.message);
                    hideShareModal();
                    loadStrategies();
                } else {
                    alert('‚ùå ' + data.detail);
                }
            } catch (e) {
                alert('‚ùå Failed to share strategy');
            }
        }

        // ========== LICENSE KEY ACTIVATION ==========
        async function activateLicense() {
            const licenseKey = document.getElementById('license-key-input').value.trim().toUpperCase();
            const statusEl = document.getElementById('license-status');

            if (!licenseKey) {
                alert('Please enter a license key');
                return;
            }

            statusEl.style.display = 'block';
            statusEl.style.color = 'var(--accent)';
            statusEl.innerHTML = '‚è≥ Validating license...';

            const token = localStorage.getItem('ssb_token');

            try {
                const res = await fetch(`${API}/license/activate`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ license_key: licenseKey })
                });

                const data = await res.json();

                if (data.success) {
                    statusEl.innerHTML = '‚úÖ License activated successfully!';
                    statusEl.style.color = '#4ade80';
                    document.getElementById('license-key-input').value = '';
                    document.getElementById('current-plan-display').innerHTML = data.plan.toUpperCase() + ' (LIVE ENABLED)';
                    document.getElementById('stat-plan').innerText = data.plan.toUpperCase();
                    userPlan = data.plan;
                    loadPlanSettings(data.plan);
                    alert('üéâ License activated! You now have access to LIVE trading with the ' + data.plan.toUpperCase() + ' plan.');
                } else {
                    statusEl.innerHTML = '‚ùå ' + (data.detail || 'Invalid license key');
                    statusEl.style.color = '#f87171';
                }
            } catch (e) {
                console.error(e);
                statusEl.innerHTML = '‚ùå Connection error';
                statusEl.style.color = '#f87171';
            }
        }

        // Toggle private key visibility
        function toggleKeyVisibility() {
            const input = document.getElementById('cfg-pk');
            const btn = document.getElementById('toggle-key-btn');
            if (input.type === 'password') {
                input.type = 'text';
                btn.innerHTML = 'üôà HIDE';
            } else {
                input.type = 'password';
                btn.innerHTML = 'üëÅÔ∏è SHOW';
            }
        }

        // Save wallet configuration
        async function saveConfig() {
            const pk = document.getElementById('cfg-pk').value.trim();
            const statusEl = document.getElementById('save-status');

            if (!pk) {
                statusEl.style.display = 'block';
                statusEl.style.background = 'rgba(248,113,113,0.1)';
                statusEl.style.borderColor = 'rgba(248,113,113,0.3)';
                statusEl.style.color = '#f87171';
                statusEl.innerHTML = '‚ùå Please enter your private key first';
                return;
            }

            statusEl.style.display = 'block';
            statusEl.style.background = 'rgba(34,211,238,0.1)';
            statusEl.style.borderColor = 'rgba(34,211,238,0.3)';
            statusEl.style.color = '#22d3ee';
            statusEl.innerHTML = '‚è≥ Encrypting & saving securely...';

            const token = localStorage.getItem('ssb_token');

            try {
                const res = await fetch(`${API}/wallet/config`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ private_key: pk })
                });

                const data = await res.json();

                if (data.success) {
                    statusEl.style.background = 'rgba(74,222,128,0.1)';
                    statusEl.style.borderColor = 'rgba(74,222,128,0.3)';
                    statusEl.style.color = '#4ade80';
                    statusEl.innerHTML = '‚úÖ Wallet saved securely!';
                    document.getElementById('cfg-pk').value = ''; // Clear for security
                    document.getElementById('cfg-pk').type = 'password';
                    document.getElementById('toggle-key-btn').innerHTML = 'üëÅÔ∏è SHOW';

                    if (data.address) {
                        document.getElementById('wallet-address-display').innerText = data.address;
                    }
                    if (data.balance !== undefined) {
                        document.getElementById('wallet-balance-display').innerText = data.balance + ' SOL';
                    }
                } else {
                    statusEl.style.background = 'rgba(248,113,113,0.1)';
                    statusEl.style.borderColor = 'rgba(248,113,113,0.3)';
                    statusEl.style.color = '#f87171';
                    statusEl.innerHTML = '‚ùå ' + (data.detail || data.message || 'Failed to save');
                }
            } catch (e) {
                console.error(e);
                statusEl.style.background = 'rgba(248,113,113,0.1)';
                statusEl.style.borderColor = 'rgba(248,113,113,0.3)';
                statusEl.style.color = '#f87171';
                statusEl.innerHTML = '‚ùå Connection error - try again';
            }
        }

        // Mobile menu toggle
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');

            // Add/remove overlay when sidebar opens
            if (sidebar.classList.contains('open')) {
                const overlay = document.createElement('div');
                overlay.id = 'mobile-overlay';
                overlay.style.cssText = 'position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:999;';
                overlay.onclick = () => {
                    sidebar.classList.remove('open');
                    overlay.remove();
                };
                document.body.appendChild(overlay);
            } else {
                const overlay = document.getElementById('mobile-overlay');
                if (overlay) overlay.remove();
            }
        }

        // Close sidebar when clicking nav items on mobile
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const sidebar = document.getElementById('sidebar');
                if (window.innerWidth <= 768 && sidebar.classList.contains('open')) {
                    sidebar.classList.remove('open');
                    const overlay = document.getElementById('mobile-overlay');
                    if (overlay) overlay.remove();
                }
            });
        });

        window.onload = init;
    </script>
</body>

</html>